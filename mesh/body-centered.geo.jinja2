//Generate mesh for body-centered pore.
//usage:
//gmsh thisfile.geo -

//This is a jinja2 template
{# Required input variables:
    mcar = characteristic length for mesh refinement
    Lx = unit cell x-length
    Ly = unit cell y-length
    R = pore radius
    H = bulk distance above and below pore included in model
    tm = pore length
  No optional input variables.
  Use trim_blocks=True.
  #}

//Mesh density control
mcar={{ mcar }};

//Geometric inputs
Lx={{ Lx }};
Ly={{ Ly }};
R={{ R }};
H={{ H }};
tm={{ tm }};

//Point ordinates
X1=0;
X2=R;
X3=Lx;
Y1=0;
Y2=R;
Y3=Ly;
Z1=0;
Z2=H;
Z3=H+tm;
Z4=2*H+tm;

//Points
{% set ptlist = ['111',        '311', '331', '131',
                 '112', '212', '312', '332', '132', '122',
                 '113', '213', '313', '333', '133', '123',
                 '114',        '314', '334', '134'] %}
{% for ptnum in ptlist %}
p{{ ptnum }}=newp; Point(p{{ ptnum }})={X{{ ptnum[0] }},Y{{ ptnum[1] }},Z{{ ptnum[2] }},mcar};
{% endfor %}

{# Define the surfaces in terms of the points.
  In the following table of values, each tuple is a line loop that will be turned into a surface.
  Circles can be included by including 'center' followed by the center point.
  The preceeding and next points are the circle start and end points, respectively.#}
{% set geomtable = {1:(111, 311, 331, 131, 111),
                    2:(212, 312, 332, 132, 122, 'center', 112, 212),
                    3:(213, 313, 333, 133, 123, 'center', 113, 213),
                    4:(114, 314, 334, 134, 114),
                    5:(111, 311, 312, 212, 213, 313, 314, 114, 111),
                    6:(111, 131, 132, 122, 123, 133, 134, 114, 111),
                    7:(331, 131, 132, 332, 331),
                    8:(311, 331, 332, 312, 311),
                    9:(333, 133, 134, 334, 333),
                    10:(313, 333, 334, 314, 313),
                    11:(212, 'center', 112, 122, 123, 'center', 113, 213, 212)} %}
{# Break the table down into surfaces of lines and circles #}


//Lines
{% set linelist = [(111, 311), (311, 331), (331, 131), (131, 111)] %}
{% for linepair in linelist %}
  {%- set startp = linepair[0]|string %}
  {%- set endp = linepair[1]|string %}
  {%- set lname = 'l'+startp+'_'+endp %}
{{ lname }}=newl; Line({{ lname }})={p{{ startp }}, p{{ endp -}} };
{% endfor %}

//Circles

//Line Loops

//Surfaces

//Surface Loops

//Volume Entities

//Mesh

//Blank lines
//because gmsh gets confused without them





